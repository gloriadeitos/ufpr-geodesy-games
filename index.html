<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passatempo Geodésico</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .geodesic-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .game-card {
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: none;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .card-header {
            background-color: #2a5298;
            color: white;
            font-weight: bold;
        }
        .quiz-container {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .question {
            font-weight: 600;
            margin-bottom: 1.5rem;
        }
        .option {
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: 1px solid #dee2e6;
        }
        .option:hover {
            background-color: #f1f3f5;
        }
        .option.selected {
            background-color: #d1e7ff;
            border-color: #86b7fe;
        }
        .option.correct {
            background-color: #d1fae5;
            border-color: #34d399;
        }
        .option.incorrect {
            background-color: #fee2e2;
            border-color: #f87171;
        }
        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 5px;
            display: none;
        }
        .feedback.correct {
            background-color: #d1fae5;
            color: #065f46;
        }
        .feedback.incorrect {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .progress-container {
            margin-bottom: 2rem;
        }
        .progress {
            height: 10px;
        }
        .result-container {
            display: none;
            text-align: center;
            padding: 2rem;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .result-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        .btn-geodesic {
            background-color: #2a5298;
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            transition: all 0.3s;
        }
        .btn-geodesic:hover {
            background-color: #1e3c72;
            color: white;
            transform: translateY(-2px);
        }
        .btn-geodesic-outline {
            background-color: transparent;
            color: #2a5298;
            border: 2px solid #2a5298;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            transition: all 0.3s;
        }
        .btn-geodesic-outline:hover {
            background-color: #2a5298;
            color: white;
        }
        .icon-feature {
            font-size: 2.5rem;
            color: #2a5298;
            margin-bottom: 1rem;
        }
        .feature-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: 10px;
            height: 100%;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .download-section {
            background-color: #e9f5ff;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="geodesic-header">
        <div class="container text-center">
            <h1><i class="fas fa-globe-americas"></i> Passatempo Geodésico</h1>
            <p class="lead">Teste seus conhecimentos em Geodésia e Sistemas de Referência</p>
        </div>
    </header>

    <div class="container">
        <!-- Game Selection -->
        <div class="row mb-4" id="game-selection">
            <div class="col-12 mb-4">
                <h2 class="text-center mb-4">Escolha seu desafio</h2>
            </div>
            
            <div class="col-md-4">
                <div class="game-card card h-100">
                    <div class="card-header">
                        <i class="fas fa-crosshairs"></i> Conceitos Básicos
                    </div>
                    <div class="card-body">
                        <p class="card-text">Teste seus conhecimentos sobre os fundamentos da Geodésia, sistemas de medida e conceitos gerais.</p>
                        <button class="btn btn-geodesic w-100 start-quiz" data-quiz="basic">Iniciar Quiz</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="game-card card h-100">
                    <div class="card-header">
                        <i class="fas fa-vector-square"></i> Sistemas Cartesianos
                    </div>
                    <div class="card-body">
                        <p class="card-text">Desafie-se com questões sobre sistemas 2D e 3D, transformações e coordenadas.</p>
                        <button class="btn btn-geodesic w-100 start-quiz" data-quiz="cartesian">Iniciar Quiz</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="game-card card h-100">
                    <div class="card-header">
                        <i class="fas fa-globe"></i> Terra Esférica
                    </div>
                    <div class="card-body">
                        <p class="card-text">Questões sobre trigonometria esférica, ortodrômica, loxodrômica e posicionamento.</p>
                        <button class="btn btn-geodesic w-100 start-quiz" data-quiz="spherical">Iniciar Quiz</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="quiz-container" style="display: none;">
            <div class="progress-container">
                <div class="d-flex justify-content-between mb-2">
                    <span id="question-counter">Pergunta 1 de 10</span>
                    <span id="score-counter">Pontuação: 0</span>
                </div>
                <div class="progress">
                    <div id="quiz-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                </div>
            </div>
            
            <div id="question-container">
                <div class="question" id="question-text">Carregando pergunta...</div>
                <div id="options-container">
                    <!-- Options will be inserted here by JavaScript -->
                </div>
                <div id="feedback" class="feedback"></div>
            </div>
            
            <div class="d-flex justify-content-between mt-4">
                <button id="prev-btn" class="btn btn-geodesic-outline" disabled>
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button id="next-btn" class="btn btn-geodesic">
                    Próxima <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Result Container -->
        <div id="result-container" class="result-container">
            <div id="result-icon" class="result-icon text-success">
                <i class="fas fa-trophy"></i>
            </div>
            <h2 id="result-title">Parabéns!</h2>
            <p id="result-message">Você completou o quiz com sucesso!</p>
            <p id="result-score" class="h4 mb-4">Sua pontuação: <span class="fw-bold">0</span>/10</p>
            <div class="d-flex justify-content-center gap-3">
                <button id="restart-btn" class="btn btn-geodesic">
                    <i class="fas fa-redo"></i> Jogar Novamente
                </button>
                <button id="download-pdf-btn" class="btn btn-geodesic-outline">
                    <i class="fas fa-file-pdf"></i> Baixar PDF
                </button>
                <button id="back-to-menu-btn" class="btn btn-geodesic-outline">
                    <i class="fas fa-home"></i> Menu Principal
                </button>
            </div>
        </div>

        <!-- Features Section -->
        <div class="row mt-5">
            <div class="col-12 mb-4">
                <h2 class="text-center">Como funciona o jogo</h2>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="feature-card">
                    <div class="icon-feature">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h4>Baseado no Conteúdo</h4>
                    <p>Perguntas elaboradas a partir dos materiais de Geodésia e Sistemas de Referência da UFPR.</p>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="feature-card">
                    <div class="icon-feature">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h4>Teste seu Conhecimento</h4>
                    <p>Desafie-se com questões sobre conceitos fundamentais e aplicações práticas.</p>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="feature-card">
                    <div class="icon-feature">
                        <i class="fas fa-download"></i>
                    </div>
                    <h4>Material para Download</h4>
                    <p>Baixe um PDF com as respostas e explicações para estudo posterior.</p>
                </div>
            </div>
        </div>

        <!-- Download Section -->
        <div class="download-section">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h3><i class="fas fa-file-pdf"></i> Baixe o material completo</h3>
                    <p>Quer estudar offline? Baixe um PDF com todas as perguntas, respostas e explicações detalhadas.</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <button id="download-full-pdf" class="btn btn-geodesic btn-lg">
                        <i class="fas fa-download"></i> Baixar PDF Completo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">Passatempo Geodésico - Disciplina de Geodésia - UFPR</p>
            <p class="text-muted small mb-0">Desenvolvido para fins educacionais</p>
        </div>
    </footer>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Quiz data based on the PDF content
        const quizzes = {
            basic: {
                title: "Conceitos Básicos de Geodésia",
                questions: [
                    {
                        question: "Qual é a definição original do metro baseada em Geodésia?",
                        options: [
                            "1/10.000.000 da distância do equador ao polo norte medida no meridiano de Paris",
                            "Comprimento do trajeto percorrido pela luz no vácuo durante 1/299792458 do segundo",
                            "Distância entre duas marcas em uma barra de platina-irídio",
                            "1/40.000.000 da circunferência da Terra"
                        ],
                        answer: 0,
                        explanation: "A definição original do metro (século XVIII) era baseada em Geodésia, como 1/10.000.000 do quadrante de meridiano da Terra (distância do equador ao polo norte medida no meridiano de Paris)."
                    },
                    {
                        question: "Qual é a diferença entre um sistema dextrogiro e levogiro?",
                        options: [
                            "Dextrogiro segue a regra da mão direita, levogiro da mão esquerda",
                            "Dextrogiro tem eixo Z para cima, levogiro para baixo",
                            "Dextrogiro usa metros, levogiro usa pés",
                            "Não há diferença, são termos intercambiáveis"
                        ],
                        answer: 0,
                        explanation: "Um sistema dextrogiro segue a regra da mão direita: se você curvar os dedos da mão direita do eixo X para o Y, o polegar apontará para o eixo Z positivo. O levogiro segue a regra da mão esquerda."
                    },
                    {
                        question: "Qual é o valor de 1 hectare em metros quadrados?",
                        options: [
                            "10.000 m²",
                            "1.000 m²",
                            "100 m²",
                            "1 m²"
                        ],
                        answer: 0,
                        explanation: "1 hectare equivale a 10.000 m² (100m x 100m). É uma unidade de área comumente usada em medições de terrenos."
                    },
                    {
                        question: "Qual destes NÃO é um tipo de norte mencionado nos materiais?",
                        options: [
                            "Norte astronômico",
                            "Norte geodésico",
                            "Norte magnético",
                            "Norte de quadrícula"
                        ],
                        answer: 0,
                        explanation: "Os tipos de norte mencionados são: geodésico (verdadeiro), magnético, de quadrícula e topográfico (local/arbitrário). Norte astronômico não foi especificamente mencionado."
                    },
                    {
                        question: "Qual é a fórmula para calcular a distância horizontal entre dois pontos em coordenadas cartesianas 2D?",
                        options: [
                            "√[(X₂-X₁)² + (Y₂-Y₁)²]",
                            "(X₂-X₁) + (Y₂-Y₁)",
                            "√[(X₂+X₁)² - (Y₂+Y₁)²]",
                            "(X₂² + Y₂²) - (X₁² + Y₁²)"
                        ],
                        answer: 0,
                        explanation: "A distância horizontal (ou distância euclidiana no plano) entre dois pontos 1 e 2 é calculada por dh₁₂ = √[(X₂-X₁)² + (Y₂-Y₁)²], que vem do teorema de Pitágoras."
                    }
                ]
            },
            cartesian: {
                title: "Sistemas Cartesianos",
                questions: [
                    {
                        question: "Em um sistema cartesiano tridimensional geodésico, qual eixo normalmente coincide com o eixo de rotação da Terra?",
                        options: [
                            "Eixo Z",
                            "Eixo X",
                            "Eixo Y",
                            "Nenhum dos eixos"
                        ],
                        answer: 0,
                        explanation: "No sistema cartesiano tridimensional geodésico, o eixo Z é fixado na direção do eixo de rotação da Terra, positivo para o Polo Norte (PN)."
                    },
                    {
                        question: "Qual é a sequência correta de transformações na fórmula de Bursa-Wolf?",
                        options: [
                            "Escala → Rotação → Translação",
                            "Translação → Rotação → Escala",
                            "Rotação → Translação → Escala",
                            "Escala → Translação → Rotação"
                        ],
                        answer: 0,
                        explanation: "O modelo de transformação Bursa-Wolf segue a sequência: (1 + δ) para escala, depois rotação (R₃(εz)R₂(εy)R₁(εx)), e finalmente translação (x₀,y₀,z₀)."
                    },
                    {
                        question: "Qual matriz representa uma rotação de θ graus em torno do eixo Z?",
                        options: [
                            "[cosθ sinθ 0; -sinθ cosθ 0; 0 0 1]",
                            "[1 0 0; 0 cosθ sinθ; 0 -sinθ cosθ]",
                            "[cosθ 0 -sinθ; 0 1 0; sinθ 0 cosθ]",
                            "[cosθ -sinθ 0; sinθ cosθ 0; 0 0 1]"
                        ],
                        answer: 0,
                        explanation: "A matriz de rotação em torno do eixo Z é R₃(θ) = [cosθ sinθ 0; -sinθ cosθ 0; 0 0 1]. Note que a rotação é positiva no sentido anti-horário (dextrogiro)."
                    },
                    {
                        question: "Como se converte coordenadas polares (Az, di, Z) para cartesianas 3D?",
                        options: [
                            "X = di·senZ·senAz; Y = di·senZ·cosAz; Z = di·cosZ",
                            "X = di·cosZ·cosAz; Y = di·cosZ·senAz; Z = di·senZ",
                            "X = di·cosAz; Y = di·senAz; Z = di·tanZ",
                            "X = di·senAz; Y = di·cosAz; Z = di"
                        ],
                        answer: 0,
                        explanation: "As fórmulas de conversão são: X = di·senZ·senAz; Y = di·senZ·cosAz; Z = di·cosZ, onde di é distância inclinada, Z é ângulo zenital e Az é azimute."
                    },
                    {
                        question: "Qual é a principal característica de uma transformação de Helmert (similaridade)?",
                        options: [
                            "Preserva ângulos mas não tamanhos",
                            "Preserva tamanhos mas não ângulos",
                            "Não preserva nem ângulos nem tamanhos",
                            "Preserva tanto ângulos quanto tamanhos"
                        ],
                        answer: 0,
                        explanation: "A transformação de Helmert (ou de similaridade) preserva ângulos (é isogonal) mas não preserva tamanhos, pois inclui um fator de escala uniforme."
                    }
                ]
            },
            spherical: {
                title: "Terra Esférica",
                questions: [
                    {
                        question: "Qual é a definição de um círculo máximo na Terra esférica?",
                        options: [
                            "Circunferência que contém o centro da esfera",
                            "Circunferência paralela ao equador",
                            "Circunferência com raio igual ao da Terra",
                            "Circunferência que passa pelos polos"
                        ],
                        answer: 0,
                        explanation: "Um círculo máximo (ou circunferência máxima) é qualquer circunferência na superfície esférica que contém o centro da esfera. Exemplos: equador e meridianos."
                    },
                    {
                        question: "Como se calcula o raio de um paralelo (Rₚ) em função da latitude (φ)?",
                        options: [
                            "Rₚ = R·cosφ",
                            "Rₚ = R·senφ",
                            "Rₚ = R·tanφ",
                            "Rₚ = R/cosφ"
                        ],
                        answer: 0,
                        explanation: "O raio de um paralelo diminui conforme aumenta a latitude: Rₚ = R·cosφ, onde R é o raio da Terra e φ é a latitude geográfica."
                    },
                    {
                        question: "Qual é a característica principal de uma linha loxodrômica?",
                        options: [
                            "Mantém um ângulo constante com todos os meridianos",
                            "Representa a menor distância entre dois pontos",
                            "Sempre cruza os meridianos a 90 graus",
                            "É um círculo máximo"
                        ],
                        answer: 0,
                        explanation: "A loxodrômica é uma linha na superfície terrestre que faz um ângulo constante (rumo/azimute) com todos os meridianos, tendo formato de espiral."
                    },
                    {
                        question: "Qual é a distância esférica (d) entre dois pontos A e B na Terra esférica?",
                        options: [
                            "d = arccos[senφₐ·senφᵦ + cosφₐ·cosφᵦ·cosΔλ]",
                            "d = √[senφₐ·senφᵦ + cosφₐ·cosφᵦ·cosΔλ]",
                            "d = R·[senφₐ + senφᵦ + cosΔλ]",
                            "d = R·arccos[φₐ - φᵦ + Δλ]"
                        ],
                        answer: 0,
                        explanation: "A distância esférica (arco de circunferência máxima) é calculada por: cos(d) = senφₐ·senφᵦ + cosφₐ·cosφᵦ·cosΔλ, onde Δλ = λᵦ - λₐ."
                    },
                    {
                        question: "Como Eratóstenes calculou o raio da Terra em 200 a.C.?",
                        options: [
                            "Medindo sombras em duas cidades no solstício",
                            "Observando navios desaparecerem no horizonte",
                            "Calculando a curvatura em eclipses lunares",
                            "Medindo o tempo de viagem entre cidades"
                        ],
                        answer: 0,
                        explanation: "Eratóstenes comparou a sombra de uma vareta em Alexandria com a ausência de sombra em Siena (Assuã) no solstício, calculando o raio terrestre com impressionante precisão."
                    }
                ]
            }
        };

        // Game state variables
        let currentQuiz = null;
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let quizData = [];

        // DOM elements
        const gameSelection = document.getElementById('game-selection');
        const quizContainer = document.getElementById('quiz-container');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackDiv = document.getElementById('feedback');
        const questionCounter = document.getElementById('question-counter');
        const scoreCounter = document.getElementById('score-counter');
        const quizProgress = document.getElementById('quiz-progress');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultContainer = document.getElementById('result-container');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const resultScore = document.getElementById('result-score');
        const resultIcon = document.getElementById('result-icon');
        const restartBtn = document.getElementById('restart-btn');
        const downloadPdfBtn = document.getElementById('download-pdf-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const downloadFullPdf = document.getElementById('download-full-pdf');

        // Start quiz buttons
        document.querySelectorAll('.start-quiz').forEach(button => {
            button.addEventListener('click', function() {
                currentQuiz = this.getAttribute('data-quiz');
                startQuiz(currentQuiz);
            });
        });

        // Start a new quiz
        function startQuiz(quizType) {
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            quizData = quizzes[quizType].questions;
            
            gameSelection.style.display = 'none';
            quizContainer.style.display = 'block';
            resultContainer.style.display = 'none';
            
            updateQuestionCounter();
            updateScore();
            loadQuestion();
        }

        // Load the current question
        function loadQuestion() {
            const question = quizData[currentQuestion];
            questionText.textContent = question.question;
            
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (userAnswers[currentQuestion] !== undefined && userAnswers[currentQuestion] === index) {
                    optionDiv.classList.add('selected');
                }
                optionDiv.textContent = option;
                optionDiv.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionDiv);
            });
            
            // Hide feedback when loading new question
            feedbackDiv.style.display = 'none';
            feedbackDiv.className = 'feedback';
            feedbackDiv.innerHTML = '';
            
            // Update button states
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finalizar' : 'Próxima';
            
            // If user already answered this question, show feedback
            if (userAnswers[currentQuestion] !== undefined) {
                showFeedback();
            }
        }

        // Select an option
        function selectOption(index) {
            // Remove selected class from all options
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            document.querySelectorAll('.option')[index].classList.add('selected');
            
            // Store user's answer
            userAnswers[currentQuestion] = index;
            
            // Show feedback immediately
            showFeedback();
        }

        // Show feedback for the current question
        function showFeedback() {
            const question = quizData[currentQuestion];
            const userAnswer = userAnswers[currentQuestion];
            
            // Remove all feedback classes
            feedbackDiv.className = 'feedback';
            
            if (userAnswer !== undefined) {
                // Mark correct and incorrect answers
                document.querySelectorAll('.option').forEach((option, index) => {
                    if (index === question.answer) {
                        option.classList.add('correct');
                    } else if (index === userAnswer && index !== question.answer) {
                        option.classList.add('incorrect');
                    }
                });
                
                // Show feedback message
                feedbackDiv.style.display = 'block';
                if (userAnswer === question.answer) {
                    feedbackDiv.classList.add('correct');
                    feedbackDiv.innerHTML = `<i class="fas fa-check-circle"></i> Correto! ${question.explanation}`;
                } else {
                    feedbackDiv.classList.add('incorrect');
                    feedbackDiv.innerHTML = `<i class="fas fa-times-circle"></i> Incorreto. A resposta correta é: ${question.options[question.answer]}. ${question.explanation}`;
                }
            }
        }

        // Navigate to previous question
        prevBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        });

        // Navigate to next question or finish quiz
        nextBtn.addEventListener('click', () => {
            // Check if current question was answered
            if (userAnswers[currentQuestion] === undefined) {
                alert('Por favor, selecione uma resposta antes de continuar.');
                return;
            }
            
            // Update score if moving forward to a new question
            if (currentQuestion === quizData.length - 1) {
                finishQuiz();
            } else {
                currentQuestion++;
                loadQuestion();
            }
        });

        // Finish the quiz and show results
        function finishQuiz() {
            // Calculate final score
            score = 0;
            userAnswers.forEach((answer, index) => {
                if (answer === quizData[index].answer) {
                    score++;
                }
            });
            
            // Show result container
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'block';
            
            // Set result message based on score
            resultScore.innerHTML = `Sua pontuação: <span class="fw-bold">${score}</span>/${quizData.length}`;
            
            if (score === quizData.length) {
                resultTitle.textContent = 'Excelente!';
                resultMessage.textContent = 'Você acertou todas as perguntas! Dominou completamente o assunto.';
                resultIcon.className = 'result-icon text-success';
                resultIcon.innerHTML = '<i class="fas fa-trophy"></i>';
            } else if (score >= quizData.length * 0.7) {
                resultTitle.textContent = 'Muito bom!';
                resultMessage.textContent = 'Você demonstrou um bom conhecimento do assunto, mas ainda pode melhorar.';
                resultIcon.className = 'result-icon text-primary';
                resultIcon.innerHTML = '<i class="fas fa-thumbs-up"></i>';
            } else if (score >= quizData.length * 0.5) {
                resultTitle.textContent = 'Bom esforço!';
                resultMessage.textContent = 'Você acertou mais da metade, mas precisa revisar alguns conceitos.';
                resultIcon.className = 'result-icon text-warning';
                resultIcon.innerHTML = '<i class="fas fa-book-open"></i>';
            } else {
                resultTitle.textContent = 'Continue estudando!';
                resultMessage.textContent = 'Você precisa revisar os conceitos básicos. Não desanime!';
                resultIcon.className = 'result-icon text-danger';
                resultIcon.innerHTML = '<i class="fas fa-redo"></i>';
            }
        }

        // Update question counter
        function updateQuestionCounter() {
            questionCounter.textContent = `Pergunta ${currentQuestion + 1} de ${quizData.length}`;
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            quizProgress.style.width = `${progress}%`;
        }

        // Update score counter
        function updateScore() {
            let currentScore = 0;
            for (let i = 0; i <= currentQuestion; i++) {
                if (userAnswers[i] !== undefined && userAnswers[i] === quizData[i].answer) {
                    currentScore++;
                }
            }
            scoreCounter.textContent = `Pontuação: ${currentScore}`;
        }

        // Restart quiz button
        restartBtn.addEventListener('click', () => {
            startQuiz(currentQuiz);
        });

        // Back to menu button
        backToMenuBtn.addEventListener('click', () => {
            gameSelection.style.display = 'block';
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'none';
        });

        // Download PDF with answers
        downloadPdfBtn.addEventListener('click', generateResultsPdf);
        downloadFullPdf.addEventListener('click', generateFullContentPdf);

        // Generate PDF with quiz results
        function generateResultsPdf() {
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text(`Resultados do Passatempo Geodésico`, 105, 20, { align: 'center' });
            doc.setFontSize(16);
            doc.text(`${quizzes[currentQuiz].title}`, 105, 30, { align: 'center' });
            
            // Score
            doc.setFontSize(14);
            doc.text(`Pontuação: ${score} de ${quizData.length}`, 105, 40, { align: 'center' });
            
            // Date
            const today = new Date();
            doc.text(`Data: ${today.toLocaleDateString()}`, 105, 50, { align: 'center' });
            
            // Add line
            doc.line(20, 55, 190, 55);
            
            // Questions and answers
            let yPos = 65;
            doc.setFontSize(12);
            
            quizData.forEach((question, index) => {
                // Question
                doc.setFont('helvetica', 'bold');
                doc.text(`${index + 1}. ${question.question}`, 20, yPos);
                yPos += 10;
                
                // User's answer
                doc.setFont('helvetica', 'normal');
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.answer;
                
                doc.setTextColor(isCorrect ? '#0d6e0d' : '#d63333');
                doc.text(`Sua resposta: ${question.options[userAnswer]}`, 25, yPos);
                doc.setTextColor('#000000');
                yPos += 7;
                
                // Correct answer if wrong
                if (!isCorrect) {
                    doc.text(`Resposta correta: ${question.options[question.answer]}`, 25, yPos);
                    yPos += 7;
                }
                
                // Explanation
                doc.text(`Explicação: ${question.explanation}`, 25, yPos);
                yPos += 15;
                
                // Add small space between questions
                yPos += 5;
                
                // Add new page if needed
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
            });
            
            // Save the PDF
            doc.save(`Resultados_Geodesia_${currentQuiz}.pdf`);
        }

        // Generate PDF with full content
        function generateFullContentPdf() {
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text(`Material Completo de Geodésia`, 105, 20, { align: 'center' });
            doc.setFontSize(14);
            doc.text(`Baseado nos conteúdos da UFPR`, 105, 30, { align: 'center' });
            
            // Date
            const today = new Date();
            doc.text(`Data: ${today.toLocaleDateString()}`, 105, 40, { align: 'center' });
            
            // Add line
            doc.line(20, 45, 190, 45);
            
            // Introduction
            let yPos = 55;
            doc.setFontSize(12);
            doc.text(`Este material contém todas as perguntas e respostas dos quizzes sobre:`, 20, yPos);
            yPos += 10;
            doc.text(`- Conceitos Básicos de Geodésia`, 20, yPos);
            yPos += 7;
            doc.text(`- Sistemas Cartesianos`, 20, yPos);
            yPos += 7;
            doc.text(`- Terra Esférica`, 20, yPos);
            yPos += 15;
            
            // Loop through all quizzes
            Object.keys(quizzes).forEach(quizKey => {
                const quiz = quizzes[quizKey];
                
                // Quiz title
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(quiz.title, 20, yPos);
                yPos += 10;
                
                // Questions
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                
                quiz.questions.forEach((question, index) => {
                    // Question
                    doc.setFont('helvetica', 'bold');
                    doc.text(`${index + 1}. ${question.question}`, 20, yPos);
                    yPos += 10;
                    
                    // Options
                    doc.setFont('helvetica', 'normal');
                    question.options.forEach((option, optIndex) => {
                        const marker = optIndex === question.answer ? '✓' : '○';
                        doc.text(`${marker} ${option}`, 25, yPos);
                        yPos += 7;
                    });
                    
                    // Explanation
                    doc.text(`Explicação: ${question.explanation}`, 25, yPos);
                    yPos += 15;
                    
                    // Add small space between questions
                    yPos += 5;
                    
                    // Add new page if needed
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                });
                
                // Add space between quizzes
                yPos += 10;
            });
            
            // Save the PDF
            doc.save(`Material_Completo_Geodesia.pdf`);
        }
    </script>
</body>
</html>
